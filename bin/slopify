#!/usr/bin/env python3

import os
import sys
from configparser import ConfigParser

config = ConfigParser()
config.optionxform=str

if not config.read(os.path.expanduser("~/.slopify.ini")):
    print("Could not read ~/.slopify.ini", file=sys.stderr)
    sys.exit(1)

# As a covenience utility users can set env vars in the config file.
envs = dict(config["envs"]) if "envs" in config else {}
os.environ.update(envs)

project_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

if len(sys.argv) == 1:
  print("Usage: slopify <subcommand> (try `slopify help`)")
  sys.exit(1)

subcommand = sys.argv[1]
subcommand_path = os.path.join(project_dir, "subcommands", subcommand)

if not os.path.exists(subcommand_path):
  print(f"Subcommand {subcommand} does not exist")
  sys.exit(1) 

os.execlp(subcommand_path, subcommand_path, *sys.argv[1:])
